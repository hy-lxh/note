
        <!DOCTYPE html>
         <html lang="en">
         <head>
	     <meta charset="UTF-8">
         <meta name="keywords" content="前端存储indexedDB,博客,前端"/>
         <meta name="description" content="IndexedDB是一个基于事务操作的key-value型前端数据库"/>
         <!--<meta http-equiv="content-security-policy" content="default-src self"/>-->
	     <title>前端存储indexedDB</title>
        </head>
        <link rel="stylesheet" href="../main.css">
        <body>
        <div class="message_box"></div>
        <div class="content">
           <div id="view">
              <div>
                <div class="bs_content">
                   <h2 id='IndexedDB' class='ZG723506'>IndexedDB</h2><h3 id='基本使用' class='Id149016'>基本使用</h3><pre class='code' data-key='pre'>
                        <div class="code_header">
                          <div class="circle">
                           <div class="circle1"></div>
                           <div class="circle2"></div>
                           <div class="circle3"></div>
                          </div>
                          <svg title="复制" t="1649216860822" class="copy_code icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3280" width="24" height="24"><path d="M441.47 537.05h186.18v59.22H441.47zM441.47 671.04h280.56v59.22H441.47z" p-id="3281"></path><path d="M685.92 217.95c-0.62-0.65-1.27-1.25-1.93-1.84l-6.85-7.18h-9.52a29.56 29.56 0 0 0-6.31 0h-59.93l1.81-1.73-86.3-90.62H221.06a60.21 60.21 0 0 0-60.15 60.15V742.1a60.21 60.21 0 0 0 60.15 60.15h100.11v32.2a60.21 60.21 0 0 0 60.15 60.15h440.82a60.21 60.21 0 0 0 60.15-60.15V424L746.8 282z m93.95 184.69l-92.81-4.54a0.85 0.85 0 0 1-0.6-0.93l4.25-88.22 12.61 13.22zM221.06 743a1 1 0 0 1-0.93-0.93V176.73a1 1 0 0 1 0.93-0.93h270.45l31.55 33.13H381.32a60.21 60.21 0 0 0-60.15 60.15V743z m601.09 92.35H381.32a1 1 0 0 1-0.93-0.93V269.08a1 1 0 0 1 0.93-0.93h252.07l-6.08 126.27v0.12c-1.46 33.12 24.17 61.25 57 62.71L823.07 464v370.45a1 1 0 0 1-0.93 0.93z" p-id="3282"></path></svg>
                        </div>
                        <div class='indexPre'><div class='index'>1.</div><div class='index'>2.</div><div class='index'>3.</div><div class='index'>4.</div><div class='index'>5.</div><div class='index'>6.</div><div class='index'>7.</div><div class='index'>8.</div><div class='index'>9.</div><div class='index'>10.</div><div class='index'>11.</div><div class='index'>12.</div><div class='index'>13.</div><div class='index'>14.</div><div class='index'>15.</div><div class='index'>16.</div><div class='index'>17.</div><div class='index'>18.</div><div class='index'>19.</div><div class='index'>20.</div><div class='index'>21.</div><div class='index'>22.</div><div class='index'>23.</div><div class='index'>24.</div><div class='index'>25.</div></div><div class="codePre"><code data-key='xmp'><span class="let">const </span>request <span class="let">=</span> window<span class="log">.</span><span class="title1">indexedDB</span><span class="log">.</span><span class="title1">open</span><span class="log">(</span><span class="string">"数据库名称"</span>,版本<span class="log">)</span>;</code><code data-key='xmp'>request<span class="log">.</span><span class="title1">addEventLisdtener</span><span class="log">(</span><span class="string">"success"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>  <span class="green">//这个事件主要就是数据打开或者创建成功后执行回调</span></code><code data-key='xmp'><span class="let">  const </span>db <span class="let">=</span> ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span>;</code><code data-key='xmp'><span class="let">  const </span>txt <span class="let">=</span> db<span class="log">.</span><span class="title1">transaction</span><span class="log">(</span><span class="string">"表名"</span>,<span class="string">"这个是mode"</span><span class="log">)</span>;<span class="green">//mode只读就是readonly,要写入和删除就是readwrite</span></code><code data-key='xmp'><span class="let">  const </span>store <span class="let">=</span> txt<span class="log">.</span><span class="title1">objectStore</span><span class="log">(</span><span class="string">"表名"</span><span class="log">)</span>;</code><code data-key='xmp'>  <span class="green">//获取数据</span></code><code data-key='xmp'>  store<span class="log">.</span><span class="title1">get</span><span class="log">(</span><span class="string">"下标"</span><span class="log">)</span>;<span class="green">//下标是从1开始的</span></code><code data-key='xmp'>  <span class="green">//添加数据</span></code><code data-key='xmp'>  store<span class="log">.</span><span class="title1">add</span><span class="log">(</span><span class="log">{</span></code><code data-key='xmp'>    <span class="log">.</span><span class="log">.</span><span class="log">.</span></code><code data-key='xmp'>  <span class="log">}</span><span class="log">)</span>;</code><code data-key='xmp'>  <span class="green">//删除数据</span></code><code data-key='xmp'>  store<span class="log">.</span><span class="title1">delete</span><span class="log">(</span><span class="string">"下标"</span><span class="log">)</span>;</code><code data-key='xmp'>  <span class="green">//上面这些操作都是异步的,所以需要在操作执行完后再做某些操作就要使用事件回调</span></code><code data-key='xmp'>  <span class="green">//一次事务只能操作一次,不能多次</span></code><code data-key='xmp'>  store<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"success"</span>,<span class='let'>function</span><span class="log">(</span><span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>    console<span class="log">.</span><span class="title1">log</span><span class="log">(</span><span class="string">"操作成功"</span><span class="log">)</span>;</code><code data-key='xmp'>  <span class="log">}</span><span class="log">)</span>;</code><code data-key='xmp'><span class="log">}</span>,false<span class="log">)</span>;</code><code data-key='xmp'>request<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"upgradeneeded"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>  <span class="green">//这个回调方法是第一次创建数据库或者版本改变后会执行这个回调</span></code><code data-key='xmp'>  <span class="green">//且不能创建名称一样的表,不然会报错</span></code><code data-key='xmp'>  ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span><span class="log">.</span><span class="title1">createObjectStore</span><span class="log">(</span><span class="string">"表名"</span>,<span class="log">{</span>keyPath: <span class="string">"主键字段"</span><span class="log">}</span><span class="log">)</span></code><code data-key='xmp'><span class="log">}</span>,false<span class="log">)</span>;</code></div></pre><h3 id='多项操作' class='dC096735'>多项操作</h3><div><div class='quote'>就是有时我们需要添加或者获取多项数据,不可能一项一项去添加和获取,我们就可以使用<span class="highlight">游标openCursor、IDBKeyRange</span></div></div><pre class='code' data-key='pre'>
                        <div class="code_header">
                          <div class="circle">
                           <div class="circle1"></div>
                           <div class="circle2"></div>
                           <div class="circle3"></div>
                          </div>
                          <svg title="复制" t="1649216860822" class="copy_code icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3280" width="24" height="24"><path d="M441.47 537.05h186.18v59.22H441.47zM441.47 671.04h280.56v59.22H441.47z" p-id="3281"></path><path d="M685.92 217.95c-0.62-0.65-1.27-1.25-1.93-1.84l-6.85-7.18h-9.52a29.56 29.56 0 0 0-6.31 0h-59.93l1.81-1.73-86.3-90.62H221.06a60.21 60.21 0 0 0-60.15 60.15V742.1a60.21 60.21 0 0 0 60.15 60.15h100.11v32.2a60.21 60.21 0 0 0 60.15 60.15h440.82a60.21 60.21 0 0 0 60.15-60.15V424L746.8 282z m93.95 184.69l-92.81-4.54a0.85 0.85 0 0 1-0.6-0.93l4.25-88.22 12.61 13.22zM221.06 743a1 1 0 0 1-0.93-0.93V176.73a1 1 0 0 1 0.93-0.93h270.45l31.55 33.13H381.32a60.21 60.21 0 0 0-60.15 60.15V743z m601.09 92.35H381.32a1 1 0 0 1-0.93-0.93V269.08a1 1 0 0 1 0.93-0.93h252.07l-6.08 126.27v0.12c-1.46 33.12 24.17 61.25 57 62.71L823.07 464v370.45a1 1 0 0 1-0.93 0.93z" p-id="3282"></path></svg>
                        </div>
                        <div class='indexPre'><div class='index'>1.</div><div class='index'>2.</div><div class='index'>3.</div><div class='index'>4.</div><div class='index'>5.</div><div class='index'>6.</div><div class='index'>7.</div><div class='index'>8.</div><div class='index'>9.</div><div class='index'>10.</div><div class='index'>11.</div><div class='index'>12.</div><div class='index'>13.</div><div class='index'>14.</div></div><div class="codePre"><code data-key='xmp'><span class="green">//openCursor方法有两个参数,一个是range，另一个就是方向具体生成如下</span></code><code data-key='xmp'><span class="let">const </span>range <span class="let">=</span> IDBKeyRange<span class="log">.</span><span class="title1">bound</span><span class="log">(</span>起始位置,结束位置,是否不包含起始位置,是否不包含结束位置<span class="log">)</span>;</code><code data-key='xmp'><span class="green">//后面两个参数可选,默认都是false</span></code><code data-key='xmp'><span class="let">const </span>range <span class="let">=</span> IDBKeyRange<span class="log">.</span><span class="title1">only</span><span class="log">(</span>下标<span class="log">)</span>;<span class="green">//这个只有一个</span></code><code data-key='xmp'><span class="green">//获取从起始位置到整个数据表里面的最后一条数据</span></code><code data-key='xmp'><span class="let">const </span>range <span class="let">=</span> IDBKeyRange<span class="log">.</span><span class="title1">lowerBound</span><span class="log">(</span>起始位置,是否不包含起始位置<span class="log">)</span>;</code><code data-key='xmp'><span class="green">//获取第一条到结束位置的数据</span></code><code data-key='xmp'><span class="let">const </span>range <span class="let">=</span> IDBKeyRange<span class="log">.</span><span class="title1">upperBound</span><span class="log">(</span>结束位置,是否不包含结束位置<span class="log">)</span>;</code><code data-key='xmp'> </code><code data-key='xmp'><span class="green">//dir</span></code><code data-key='xmp'><span class="let">const </span>dir <span class="let">=</span> <span class="string">"next"</span>;<span class="green">//这个表示获取的数据都是按照主键升序排列返回,如果两个主键值相等的数据也一样返回</span></code><code data-key='xmp'><span class="let">const </span>dir <span class="let">=</span> <span class="string">"nextunique"</span>;<span class="green">//升序返回,主键值相等只返回第一条数据</span></code><code data-key='xmp'><span class="let">const </span>dir <span class="let">=</span> <span class="string">"prev"</span>;<span class="green">//降序返回,所有数据全部返回</span></code><code data-key='xmp'><span class="let">const </span>dir <span class="let">=</span> <span class="string">"prevunique"</span>;<span class="green">//降序返回,主键相等只返回第一条数据</span></code></div></pre><pre class='code' data-key='pre'>
                        <div class="code_header">
                          <div class="circle">
                           <div class="circle1"></div>
                           <div class="circle2"></div>
                           <div class="circle3"></div>
                          </div>
                          <svg title="复制" t="1649216860822" class="copy_code icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3280" width="24" height="24"><path d="M441.47 537.05h186.18v59.22H441.47zM441.47 671.04h280.56v59.22H441.47z" p-id="3281"></path><path d="M685.92 217.95c-0.62-0.65-1.27-1.25-1.93-1.84l-6.85-7.18h-9.52a29.56 29.56 0 0 0-6.31 0h-59.93l1.81-1.73-86.3-90.62H221.06a60.21 60.21 0 0 0-60.15 60.15V742.1a60.21 60.21 0 0 0 60.15 60.15h100.11v32.2a60.21 60.21 0 0 0 60.15 60.15h440.82a60.21 60.21 0 0 0 60.15-60.15V424L746.8 282z m93.95 184.69l-92.81-4.54a0.85 0.85 0 0 1-0.6-0.93l4.25-88.22 12.61 13.22zM221.06 743a1 1 0 0 1-0.93-0.93V176.73a1 1 0 0 1 0.93-0.93h270.45l31.55 33.13H381.32a60.21 60.21 0 0 0-60.15 60.15V743z m601.09 92.35H381.32a1 1 0 0 1-0.93-0.93V269.08a1 1 0 0 1 0.93-0.93h252.07l-6.08 126.27v0.12c-1.46 33.12 24.17 61.25 57 62.71L823.07 464v370.45a1 1 0 0 1-0.93 0.93z" p-id="3282"></path></svg>
                        </div>
                        <div class='indexPre'><div class='index'>1.</div><div class='index'>2.</div><div class='index'>3.</div><div class='index'>4.</div><div class='index'>5.</div><div class='index'>6.</div><div class='index'>7.</div><div class='index'>8.</div><div class='index'>9.</div><div class='index'>10.</div><div class='index'>11.</div><div class='index'>12.</div><div class='index'>13.</div><div class='index'>14.</div><div class='index'>15.</div><div class='index'>16.</div><div class='index'>17.</div><div class='index'>18.</div><div class='index'>19.</div><div class='index'>20.</div><div class='index'>21.</div><div class='index'>22.</div><div class='index'>23.</div></div><div class="codePre"><code data-key='xmp'><span class="let">const </span>request <span class="let">=</span> window<span class="log">.</span><span class="title1">indexedDB</span><span class="log">.</span><span class="title1">open</span><span class="log">(</span><span class="string">"db_name"</span>,1<span class="log">)</span>;</code><code data-key='xmp'>request<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"upgradeneeded"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>  ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span><span class="log">.</span><span class="title1">createObjectStore</span><span class="log">(</span><span class="string">"users"</span>,<span class="log">{</span>keyPath: <span class="string">"id"</span><span class="log">}</span><span class="log">)</span>;</code><code data-key='xmp'><span class="log">}</span>,false<span class="log">)</span>;</code><code data-key='xmp'>request<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"success"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'><span class="let">  const </span>db <span class="let">=</span> ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span>;</code><code data-key='xmp'><span class="let">  const </span>trans <span class="let">=</span> db<span class="log">.</span><span class="title1">transaction</span><span class="log">(</span><span class="string">"users"</span><span class="log">)</span>;</code><code data-key='xmp'><span class="let">  const </span>query <span class="let">=</span> trans<span class="log">.</span><span class="title1">objectStore</span><span class="log">(</span><span class="string">"users"</span><span class="log">)</span>;</code><code data-key='xmp'><span class="let">  const </span>range <span class="let">=</span> window<span class="log">.</span><span class="title1">IDBKeyRange</span><span class="log">(</span>1,false<span class="log">)</span>;</code><code data-key='xmp'><span class="let">  const </span>req <span class="let">=</span> query<span class="log">.</span><span class="title1">openCursor</span><span class="log">(</span>range,<span class="string">"next"</span><span class="log">)</span>;</code><code data-key='xmp'>  req<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"success"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'><span class="let">    const </span>cursor <span class="let">=</span> ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span>;</code><code data-key='xmp'>    <span class="title"><span class="let">if</span><span class="log">(</span></span>cursor<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>      console<span class="log">.</span><span class="title1">log</span><span class="log">(</span>cursor<span class="log">.</span><span class="title1">value</span><span class="log">)</span>;</code><code data-key='xmp'>      cursor<span class="log">.</span><span class="title1">continue</span><span class="log">(</span><span class="log">)</span>;</code><code data-key='xmp'>    <span class="log">}</span><span class="let">else</span><span class="log">{</span></code><code data-key='xmp'>      console<span class="log">.</span><span class="title1">log</span><span class="log">(</span><span class="string">"检索结束"</span><span class="log">)</span>;</code><code data-key='xmp'>    <span class="log">}</span></code><code data-key='xmp'>  <span class="log">}</span>,false<span class="log">)</span>;</code><code data-key='xmp'><span class="log">}</span>,false<span class="log">)</span>;</code><code data-key='xmp'>request<span class="log">.</span><span class="title1">addEventListener</span><span class="log">(</span><span class="string">"error"</span>,<span class='let'>function</span><span class="log">(</span>ev<span class="log">)</span><span class="log">{</span></code><code data-key='xmp'>  console<span class="log">.</span><span class="title1">log</span><span class="log">(</span>`出错了,错误码为: $<span class="log">{</span>ev<span class="log">.</span><span class="title1">target</span><span class="log">.</span><span class="title1">result</span><span class="log">.</span><span class="title1">errorCode</span><span class="log">}</span>`<span class="log">)</span>;</code><code data-key='xmp'><span class="log">}</span>,false<span class="log">)</span>;</code></div></pre>
                </div>
                <div class="rightDraw">
                <div class="menu"><div class="directory">目录</div><ul class="menuCon"><li class="menu_li"><a href="#IndexedDB" id="ZG723506">IndexedDB</a><ul class="menuCon_1"><li class="menu_li0"><a href="#基本使用" id="Id149016">基本使用</a></li><li class="menu_li1"><a href="#多项操作" id="dC096735">多项操作</a></li></ul></li></ul></div>
                </div>
              </div>
           </div>
           <svg t="1648304059372" class="icon up" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3132" width="200" height="200"><path d="M832 64 192 64C121.6 64 64 121.6 64 192l0 640c0 70.4 57.6 128 128 128l640 0c70.4 0 128-57.6 128-128L960 192C960 121.6 902.4 64 832 64zM762.24 759.04c-12.8 12.8-33.28 12.8-45.44 0L513.92 560l-202.24 199.04c-12.8 12.8-33.28 12.8-45.44 0-12.8-12.8-12.8-32.64 0-45.44l224-220.16c6.4-6.4 15.36-9.6 24.32-8.96C522.88 483.84 531.2 487.04 538.24 493.44l224 220.16C775.04 726.4 775.04 746.24 762.24 759.04zM762.24 503.04c-12.8 12.8-33.28 12.8-45.44 0L513.92 304 311.68 503.04c-12.8 12.8-33.28 12.8-45.44 0-12.8-12.8-12.8-32.64 0-45.44l224-220.16c6.4-6.4 15.36-9.6 24.32-8.96C522.88 227.84 531.2 231.04 538.24 237.44l224 220.16C775.04 470.4 775.04 490.24 762.24 503.04z" p-id="3133" fill="#ffffff"></path></svg>
        </div>
        </body>
           <script>let titles = [{"title":"IndexedDB","id":"IndexedDB","index":2,"class":"ZG723506","children":[{"title":"基本使用","id":"基本使用","index":3,"class":"Id149016"},{"title":"多项操作","id":"多项操作","index":3,"class":"dC096735"}]}];</script>
           <script src="../index.js" type="text/javascript"></script>
           </html>
            